templates:
  - "templates/web.template.yml"
  - "templates/web.ratelimited.template.yml"
  - "templates/offline-page.template.yml"
  - "../custom-templates/k8s-web.template.yml"  # K8s overrides: Skip DB/Redis during build

env:
  LANG: en_US.UTF-8
  # Database connection placeholders - these MUST be overridden at runtime with real values
  # Using "placeholder" prevents db:migrate from running during image build
  DISCOURSE_DB_HOST: "placeholder"     # Override with real PostgreSQL host at runtime
  DISCOURSE_REDIS_HOST: "placeholder"  # Override with real Redis host at runtime
  DISCOURSE_HOSTNAME: "placeholder"    # Override with real hostname at runtime
  # K8s-specific: Run migrations when container starts (not during build)
  MIGRATE_ON_BOOT: "1"                 # Runs db:migrate on container startup with real DB

params:
  version: "{{ DISCOURSE_VERSION }}"   # Passed from CI

hooks:
  after_code:
    - exec:
        cd: $home/plugins
        cmd: []
          # Plugins injected from plugins.yml by build script
          # Note: docker_manager NOT needed for K8s deployments
